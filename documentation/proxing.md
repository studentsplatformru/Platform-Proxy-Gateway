## [Главная](../README.md)
#### [Оглавление](./main.md)
***
Для того, чтобы пропустить входящий запрос через прокси данный, сервис использует
route фильтр от zuul.
Фильтр ловит входящий запрос, получает из него адрес назначения, тело, заголовки и тд.
Далее он устанавливает свой ClosableHttpClient с прокси, выполняет через него запрос
и получает ответ, который потом отправляется клиенту.
За основу данного route фильтра был взят [SimpleHostRoutingFilter](https://github.com/spring-cloud/spring-cloud-netflix/blob/4e8d58869e800ab5491635e046b240e3eb235b36/spring-cloud-netflix-zuul/src/main/java/org/springframework/cloud/netflix/zuul/filters/route/SimpleHostRoutingFilter.java)
#### Жизненный цикл
1. Вначале заполняется список прокси используя стороннюю базу прокси.
Если сторонняя база вернула пустой список или, в результате проверки, не обнаружилось
рабочего прокси, то приложение не запустится (выбросит ошибку).
2. Далее устанавливается прокси. Теперь каждый запрос проходит через это прокси.
3. Если текущее прокси сломалось, то проверяется следующее по списку прокси и 
если рабочее, то оно устанавливается в качестве текущего, иначе - 
удаляется из списка.
4. Если на каком-то этапе список пуст - то опять запрашиваем список прокси.
Если пустой список или прокси не рабочие, то возвращается пустая страница. На следующем вызове повторится пункт 4.
Если есть хотя-бы 1 рабочее прокси, то оно устанавливается в качестве текущего и
возвращаемся к пункту 3.